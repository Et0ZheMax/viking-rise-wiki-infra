
---

### `AGENTS.md`

```markdown
# AGENTS.md — инструкции для ИИ-агентов

Этот файл предназначен для всех ИИ-инструментов (Codex, Copilot, ChatGPT и т.п.), которые будут работать с репозиторием **viking-rise-wiki-infra**.

Цель — чтобы любые автоматические/полуавтоматические правки были:

- безопасными,
- понятными человеку,
- согласованными с архитектурой проекта.

---

## 1. Общий контекст

- Репозиторий **viking-rise-wiki-infra** отвечает за **инфраструктуру Wiki.js** для wiki-сайта по игре **Viking Rise**.
- Здесь нет игрового контента (гайдов, текстов страниц) — только:
  - Docker-конфигурация,
  - Nginx-конфиги,
  - Python-скрипты (health-check, бэкапы и т.п.),
  - документация по инфраструктуре и процессам.

Цели сайта:

- Удобная wiki с визуальным редактором (Wiki.js).
- Простое добавление статей с картинками и видео.
- «Умный» поиск по статьям.
- Минималистичный интерфейс, оформленный под стиль Viking Rise.
- Возможность размещать рекламные баннеры (для будущих настроек темы и шаблонов в Wiki.js).

---

## 2. Ключевые принципы для ИИ-агентов

### 2.1. Безопасность и секреты

- **НИКОГДА** не предлагать коммитить:
  - реальные пароли и токены,
  - реальные значения переменных из `.env`.
- Все примеры значений должны быть **фиктивными** (например, `change_me_strong_password`).
- `.env` **не должен** попадать в историю git — только `.env.example` c безопасными примерами.

### 2.2. Структура и область ответственности

- Не изменять структуру репозитория **радикально** без явного запроса.
- `data/`, `backups/`, `.env*`, логи — **артефакты среды**, а не часть отслеживаемого кода.
- Основные файлы для правок:
  - `docker-compose.yml`
  - `nginx/nginx.conf`
  - `nginx/conf.d/wiki.conf`
  - `scripts/*.py`
  - файлы документации (`README.md`, `AGENTS.md`, `docs/*.md`).

### 2.3. Стиль правок кода и конфигов

При генерации/изменении кода:

- Всегда давать **полные блоки**, а не одиночные строки без контекста:
  - если меняется функция — показать функцию целиком;
  - если меняется секция Nginx или сервис в compose — показать полный блок `server { ... }` / `service: { ... }`.
- По возможности указывать:
  - строку/фрагмент **до** и **после**, если предлагается вставка для существующего файла.
- Обязательно снабжать код **комментариями**:
  - зачем нужен блок,
  - какие настройки можно менять,
  - на что обратить внимание (безопасность, порты, пути).

---

## 3. Работа с Docker и Nginx

### 3.1. `docker-compose.yml`

При изменениях:

- Не хардкодить пароли/логины — использовать переменные из `.env`.
- Следить за:
  - корректностью `depends_on` и `healthcheck`,
  - читабельными именами сервисов,
  - понятными volume-путями (`./data/db`, `./data/wiki` и т.п.).
- Учитывать, что основная рабочая среда — **Windows + Docker Desktop**, но конфиги должны быть максимально кроссплатформенными.

### 3.2. `nginx/nginx.conf` и `nginx/conf.d/wiki.conf`

- Убедиться, что `proxy_pass` указывает на `wiki:3000`.
- При добавлении заголовков безопасности — добавлять комментарии, что и для чего:
  - `X-Frame-Options`,
  - `X-Content-Type-Options`,
  - `X-XSS-Protection` (если используется),
  - и т.п.
- Подготовка к HTTPS:
  - можно документировать, что TLS может терминироваться:
    - либо во внешнем reverse-proxy/балансировщике,
    - либо в отдельной Nginx-конфигурации для HTTPS (не обязательно реализовывать, но можно описывать подход).

---

## 4. Работа с Python-скриптами (`scripts/*.py`)

Текущие основные скрипты:

- `scripts/health_check.py` — health-check инфраструктуры.
- `scripts/backup_db.py` — резервное копирование БД.

Требования к любым новым или изменённым скриптам:

- **Запуск от имени администратора** (Windows) или `root` (Linux) должен проверяться:
  - через `ctypes.windll.shell32.IsUserAnAdmin()` на Windows,
  - через `os.geteuid() == 0` на Unix (если доступно).
- Везде использовать:
  - аккуратную обработку ошибок (`try/except`),
  - внятные сообщения об ошибках на русском/английском (главное — понятно человеку).
- Избегать хардкодинга путей:
  - использовать `Path(__file__).resolve().parents[...]` для определения корня проекта,
  - не делать жёсткие привязки к дискам (`C:\...`) внутри кода.

Если добавляются новые скрипты:

- Даём понятное имя (`restore_db.py`, `rotate_backups.py` и т.п.).
- Документируем в `README.md`, как ими пользоваться.
- По возможности делаем их кроссплатформенными.

---

## 5. Документация (docs/*.md)

Для ИИ-агентов допустимы (и приветствуются):

- Создание и обновление Markdown-документов вида:
  - `docs/wiki-setup.md` — базовая настройка Wiki.js,
  - `docs/content-structure.md` — план структуры разделов,
  - `docs/article-template.md` — шаблон статьи,
  - `docs/design-notes.md` — заметки по дизайну,
  - `docs/banner-placements.md` — места для рекламных блоков,
  - `docs/roles-and-permissions.md` — роли и права,
  - `docs/how-to-create-guide.md` — инструкция для авторов без IT-опыта,
  - `docs/restore-db.md` — восстановление БД.
- В текстах документации:
  - не использовать секреты,
  - делать инструкции пошаговыми и понятными.

---

## 6. Взаимодействие с пользователем (владельцем репозитория)

При генерации предложений/патчей:

1. Сначала **прочитать**:
   - `README.md`,
   - `AGENTS.md`,
   - при необходимости — файлы в `scripts/`, `nginx/`, `docs/`.
2. Учитывать пожелания пользователя:
   - код должен быть максимально безопасным,
   - избегать SQL-инъекций (если когда-либо появится работа с SQL),
   - использовать `try/except` и понятные сообщения об ошибках,
   - не усложнять лишними зависимостями, если это не необходимо.
3. При предложении изменений:
   - показывать **полный изменяемый блок** (функция, конфиг-секция),
   - снабжать его комментариями,
   - по возможности указывать, **куда именно** вставить/чем заменить (строчки «до» и «после»).

---

## 7. Ограничения

ИИ-агентам **не следует**:

- Лезть в реальные production-секреты.
- Предлагать полностью менять стек (например, заменять Wiki.js на другой движок) без явного запроса.
- Удалять существующие сервисы/скрипты без чёткого обоснования.

---

## 8. Кратко: как мыслить ИИ в этом репо

1. **Понимать контекст** — это инфраструктура для Wiki.js, а не игровой код.
2. **Сохранять безопасность** — без секретов в Git, с аккуратной обработкой ошибок.
3. **Думать кроссплатформенно** — Windows + Docker Desktop, но не ломать Linux/WSL.
4. **Говорить на языке человека** — комментарии и документация должны быть понятны владельцу репозитория и будущим редакторам.

Если эти правила соблюдены — предложенные изменения, скорее всего, будут полезными и безопасными.
