# Codex Project Brief: viking-rise-wiki-infra

## 1. Контекст проекта

Мы делаем wiki-сайт по игре **Viking Rise** на базе **Wiki.js**.

Требования к сайту:

- Минималистичный, но красочный интерфейс.
- Удобное создание статей (гайды, обзоры) с:
  - форматированием текста,
  - картинками,
  - видео (YouTube и т.п.).
- «Умный» поиск по статьям.
- Возможность делегировать создание статей людям без IT-навыков (визуальный редактор).
- Возможность размещать рекламные баннеры и оформить цвета/фон под стиль Viking Rise.

Данный репозиторий **viking-rise-wiki-infra** отвечает только за **инфраструктуру**:

- Docker-компоуз для:
  - PostgreSQL (БД Wiki.js),
  - Wiki.js,
  - Nginx (reverse-proxy).
- Конфиги Nginx.
- Скрипты на Python для health-check и бэкапов.
- Всё это запускается на Windows (через Docker Desktop), но должно быть кроссплатформенно, где это возможно.

---

## 2. Текущий стек и файлы

**Технологии:**

- Docker + Docker Compose
- PostgreSQL 15 (alpine)
- Wiki.js (v2)
- Nginx (alpine)
- Python 3 (скрипты для health-check и backup)
- ОС: Windows + Docker Desktop (но желательно, чтобы всё работало и на Linux/WSL)

**Структура репозитория (базовая):**

- `docker-compose.yml` — запуск db + wiki + nginx.
- `.env.example` — пример env-переменных (Postgres + порты).
- `.gitignore` — исключаем данные/логи/секреты.
- `nginx/nginx.conf` — базовый конфиг Nginx.
- `nginx/conf.d/wiki.conf` — vhost для Wiki.js.
- `data/db` — volume для PostgreSQL (не коммитим).
- `data/wiki` — volume для Wiki.js (не коммитим).
- `scripts/health_check.py` — health-check инфраструктуры.
- `scripts/backup_db.py` — бэкап БД.
- `README.md` — базовое описание.

---

## 3. Цели для Codex

Главная цель — помочь выстроить **чистую, безопасную, понятную инфраструктуру** для Wiki.js и дальше постепенно добавить:

- удобные скрипты,
- документацию,
- зачатки кастомизации (цвета/баннеры через CSS и конфиги, там где это возможно из кода).

Ниже — задачи, помеченные:

- `[codex]` — то, с чем Codex может помочь в коде/конфигах/скриптах.
- `[manual]` — то, что делается вручную в веб-интерфейсе Wiki.js (для понимания контекста).

---

## 4. План задач (roadmap)

### Фаза 1 — Базовая инфраструктура и запуск

- [ ] T1 — Проверить и при необходимости доработать структуру репозитория `[codex]`  
  **Цель:** убедиться, что:
  - `.gitignore` корректно исключает `data/`, `backups/`, `.env*`, логи.
  - В репо нет жёстко захардкоженных паролей/секретов.
  - Папки `scripts/`, `nginx/`, `data/` оформлены логично и с комментариями.

- [ ] T2 — Актуализировать `README.md` под текущую структуру `[codex]`  
  **Цель:** описать:
  - назначение репозитория,
  - минимальные шаги запуска на Windows (Docker Desktop),
  - как использовать `health_check.py` и `backup_db.py`.

- [ ] T3 — Проверить и оптимизировать `docker-compose.yml` `[codex]`  
  **Цель:**
  - убедиться, что все env-переменные берутся из `.env`,
  - health-check-и корректны,
  - имена сервисов/volumes понятны,
  - комментарии на русском объясняют каждый блок.

- [ ] T4 — Проверить и, при необходимости, доработать `nginx/nginx.conf` и `nginx/conf.d/wiki.conf` `[codex]`  
  **Цель:**
  - убедиться, что Nginx корректно проксирует на `wiki:3000`,
  - добавить базовые заголовки безопасности и комментарии,
  - предусмотреть возможность дальнейшего подключения HTTPS (через внешний reverse-proxy или отдельный контейнер).

- [ ] T5 — Локальный запуск и health-check `[manual]`  
  **Цель:**
  - создать `.env` на основе `.env.example`,
  - запустить `docker compose up -d`,
  - проверить `python scripts/health_check.py`.

---

### Фаза 2 — Настройка Wiki.js и базовая тема

- [ ] T6 — Первый запуск Wiki.js и создание admin-аккаунта `[manual]`  
  **Цель:** зайти в веб-интерфейс, пройти initial setup.

- [ ] T7 — Документация по базовым настройкам Wiki.js в этом репо `[codex]`  
  **Цель:** создать файл `docs/wiki-setup.md` (или аналог), где будет:
  - список базовых настроек (язык, часовой пояс, базовый цветовой профиль),
  - где в админке менять тему, логотип, favicon,
  - как включить/настроить поиск.

---

### Фаза 3 — Структура контента и разделов Viking Rise

- [ ] T8 — Описать целевую структуру разделов wiki в Markdown-документе `[codex]`  
  **Цель:** создать `docs/content-structure.md` с примерной иерархией:
  - Старт на сервере,
  - Герои (по ролям, по редкости),
  - Фарм ресурсов,
  - Битвы, PvP, KvK,
  - Ивенты,
  - Билды/сборки,
  - FAQ и т.п.

- [ ] T9 — Шаблон статьи (гайда) `[codex]`  
  **Цель:** описать в `docs/article-template.md` пример структуры статьи:
  - заголовок,
  - краткое описание,
  - блок с картинкой/обложкой,
  - секции (шаги, советы, ошибки),
  - блок с видео (YouTube embed),
  - блок «Рекомендуемые гайды/ссылки».

  Codex может помочь оформить это в удобном Markdown-шаблоне, который потом можно перенести в Wiki.js как шаблон страницы.

---

### Фаза 4 — Дизайн под Viking Rise и рекламные блоки

- [ ] T10 — Концепция цветовой схемы и UI под Viking Rise `[codex]`  
  **Цель:** в `docs/design-notes.md` описать:
  - основные цвета (фон, акцент, кнопки),
  - шрифт/размеры,
  - общие принципы минимализма.

- [ ] T11 — Подготовить кастомный CSS для Wiki.js `[codex]`  
  **Цель:** создать файл `assets/custom-theme.css` (или `docs/custom-css-snippets.md`), где:
  - CSS-классами описаны:
    - фон страницы,
    - цвет заголовков/ссылок,
    - стили блоков с гайдами.
  - Эти стили потом будут вставлены в Wiki.js через admin → Custom CSS.

- [ ] T12 — Места под рекламные баннеры `[codex]`  
  **Цель:** в `docs/banner-placements.md` описать:
  - какие блоки баннеров нужны (верхняя панель, сайдбар, блок внизу гайда),
  - примеры HTML/CSS для баннер-блоков (которые можно вставлять в шаблоны страниц или в Layout Wiki.js, если движок позволяет),
  - варианты текстов/CTA (например «Купить ресурсы», «Наш Telegram»).

---

### Фаза 5 — Роли, редакторы и процесс работы

- [ ] T13 — Документация по ролям и доступам `[codex]`  
  **Цель:** создать `docs/roles-and-permissions.md`, где:
  - описаны роли (админ, редактор, автор, читатель),
  - прописан рекомендуемый набор прав в Wiki.js,
  - описан процесс: кто создаёт черновики, кто публикует, кто редактирует.

- [ ] T14 — Процесс добавления гайда для «не-IT» людей `[codex]`  
  **Цель:** написать понятную инструкцию для авторов (`docs/how-to-create-guide.md`):
  - как зайти в Wiki.js,
  - как создать новую страницу,
  - как вставить картинку,
  - как вставить видео,
  - как использовать шаблон статьи.

---

### Фаза 6 — Автоматизация и обслуживание

- [ ] T15 — Улучшение `scripts/health_check.py` `[codex]`  
  **Цель:** при необходимости:
  - добавить более детальные проверки (например, попытка HTTP-запроса к Nginx),
  - добавить человеко-читаемые статусы (OK / WARNING / ERROR),
  - аккуратная обработка ошибок (try/except, понятные сообщения).

- [ ] T16 — Улучшение `scripts/backup_db.py` `[codex]`  
  **Цель:**
  - добавить логирование (например, в файл `logs/backup.log`),
  - добавить простую ротацию (ограничение по количеству бэкапов),
  - аккуратную обработку ошибок (отсутствие контейнера, ошибка pg_dump).

- [ ] T17 — Документация по восстановлению БД из бэкапа `[codex]`  
  **Цель:** создать `docs/restore-db.md`:
  - как остановить контейнеры,
  - как восстановить БД из `.sql`,
  - какие команды compose использовать.

---

## 5. Как Codex может это использовать

Codex может:

- читать этот бриф и понимать:
  - какую роль играет этот репозиторий,
  - какие файлы уже есть,
  - куда можно добавлять новые скрипты/конфиги,
  - какие есть требования к безопасности, комментариям и удобству.

- по задачам `[codex]`:
  - предлагать правки и оптимизации для существующих файлов,
  - генерировать новые скрипты/конфиги/документацию,
  - выдавать патчи в формате `git apply`.

Задачи `[manual]` нужны для контекста: что будет делаться в самом Wiki.js через веб-интерфейс.
